<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  </head>
  
  <body>
    <h1>get report by report number & prompt values</h1>
    
    <form>
      <label for="Key">report number (e.g. 5378558):</label></br>
      <input type="text" id="Key" value="5378558"></br>
  </br>
      <label for="PromptValues">prompt values (e.g. 10007, 10008, 10068, , %22/23%):</label></br>
      <input type="text" id="PromptValues" value="10007, 10008, 10068, , %22/23%"></br>

<br>
<p><b>BIG OL' WARNING</b><br>
  Your list of prompt values must <u>exactly</u> match the order and amount of expected prompt values in PIP. <br>
  If you are leaving a field blank, just leave a space between commas as in the example above.</p>

      <input type="button" value="click to generate link" onClick="makeURL(this.form)">
    </form>
  
<br>PromptValues: <p id="PromptValues"></p>
<br>URL: <p id="url"></p>

  <script>
    function makeURL(form) {
      var endpoint = "https://cms.interiorhealth.ca/cms/Send?";
      var first = "operation=Execute&type=Download&image=true&ListName=list-view&FiltersSearch=&SortField=display_no&View=visible&PromptValues=";
      
      var PromptValues = encodeURIComponent(form.PromptValues.value.replaceAll(", ,", ",+,").replaceAll(" ", "").replaceAll(",", "\n")).replaceAll("%2B", "+"); 
      document.getElementById("PromptValues").innerHTML = PromptValues;
      
      var second = "&SortDirection=descending&sendButtons=true&ClassName=ReportPreview&RequestDSNAndMDN=false&ArrayFieldsRendering=expanded";
      var Key = "&Key=REPORT" + form.Key.value;
      var third = "&option=list";
      
      var url = endpoint + first + PromptValues + second + Key + third;
      var url = "<a href='" + url + "' target='new'>" + url + "</a>";
      document.getElementById("url").innerHTML = url;
    }
  </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js" integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js" integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ" crossorigin="anonymous"></script>
  </body>
</html>
